# liftover_plink

*Note: Array plink files were NI.finalSNPset.with_inferred.120717 found on Taurus at `/mnt/ihbi_ngs/fromBarrine/NorfolkIsland/`. They were mapped to GRCh37 coordinates so needed to be lifted over to build Hg38. 

Follow instructions from https://github.com/sritchie73/liftOverPlink

### Load modules
	module purge
	module load python/2.7.15-gcccore-8.3.0
	module load atg/plink/1.9b

### Download tools and chain file
	cd $path/03.array-hg38/bin
	wget http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/liftOver
	wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/liftOver/hg19ToHg38.over.chain.gz
	gzip -d hg19ToHg38.over.chain.gz
	chmod 755 liftOver

	cd ..
	git clone https://github.com/sritchie73/liftOverPlink.git

### Convert bed files to ped files
	cd $path/03.array-hg38/bin
	plink --bfile /work/compgen/users/ngan/NI/array-unimputed/inferred/NI.finalSNPset.with_inferred.120717 --recode tabx --out NI.finalSNPset.with_inferred.120717 ###599011 variants loaded

### Create a "lifted" map file
	python ../liftOverPlink/liftOverPlink.py --map NI.finalSNPset.with_inferred.120717.map --out NI.lifted --chain ./hg19ToHg38.over.chain --bin ./liftOver 

### Remove bad lifted SNPs from that MAP file.
	python ../liftOverPlink/rmBadLifts.py --map NI.lifted.map --out NI.good_lifted.map --log NI.bad_lifted.dat

### Create a file that contains “unlifted” and “bad” SNPs.
	cut -f 2 NI.bad_lifted.dat > NI.to_exclude.dat
	cut -f 4 NI.lifted.bed.unlifted | sed "/^#/d" >> NI.to_exclude.dat 

### Generate a good PED file by excluding "unlifted", and bad "lifted" SNPs.
*Note: this will clobber the lifted MAP file generated by `liftOverPlink`:
	plink --file NI.finalSNPset.with_inferred.120717 --recode --out NI.lifted --exclude NI.to_exclude.dat  

### Combine the “good” .ped and .map files
	plink --ped NI.lifted.ped --map NI.good_lifted.map --recode --out NI.final

### Convert ped/map files to bed/bim/fam files
	plink --file NI.final --make-bed --out ../NI.finalSNPset.hg38
	###582148 variants remained

